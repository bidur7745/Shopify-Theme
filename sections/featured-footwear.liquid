{% comment %}
  Featured Footwear Section with Color Options
  Displays footwear products from selected collection with dynamic color swatches
{% endcomment %}
{{ 'featured-footwear.css' | asset_url | stylesheet_tag }}
{{ 'featured-footwear.js' | asset_url | script_tag }}

<div class="featured-footwear-section">
  <div class="container">
    {% if section.settings.heading != blank %}
      <div class="section-header">
        <h2 class="section-title">{{ section.settings.heading }}</h2>
        {% if section.settings.subheading != blank %}
          <p class="section-subtitle">{{ section.settings.subheading }}</p>
        {% endif %}
      </div>
    {% endif %}

    {% assign selected_collection = collections[section.settings.collection] %}
    {% if selected_collection and selected_collection.products.size > 0 %}
      <div class="footwear-grid">
        {% for product in selected_collection.products limit: section.settings.products_to_show %}
          <div class="footwear-card">
            <div class="footwear-image-container">
              <a href="{{ product.url }}" class="footwear-image-link">
                <img 
                  class="footwear-main-image" 
                  src="{{ product.featured_image | img_url: '400x400' }}" 
                  alt="{{ product.featured_image.alt | default: product.title }}"
                  loading="lazy"
                >
              </a>
              
              {% comment %} Color swatches {% endcomment %}
              <div class="color-swatches">
                {% if product.variants.size > 1 %}
                  {% for variant in product.variants limit: 6 %}
                    {% assign show_variant = false %}
                    {% if variant.option1 contains 'Color' or variant.option1 contains 'Colour' or variant.option1 contains 'color' or variant.option1 contains 'colour' %}
                      {% assign show_variant = true %}
                    {% elsif forloop.first %}
                      {% assign show_variant = true %}
                    {% endif %}
                    
                    {% if show_variant %}
                      {% assign color_name = variant.option1 | default: 'Default' %}
                      {% assign color_value = color_name | downcase | replace: ' ', '' | replace: '-', '' %}
                      <button 
                        class="color-swatch {% if forloop.first %}active{% endif %}"
                        data-variant-id="{{ variant.id }}"
                        data-image-url="{{ variant.featured_image | img_url: '400x400' | default: product.featured_image | img_url: '400x400' }}"
                        data-product-id="{{ product.id }}"
                        style="background-color: {{ color_value }};"
                        title="{{ color_name }}"
                        aria-label="Select {{ color_name }} color"
                      >
                        <span class="color-name">{{ color_name }}</span>
                      </button>
                    {% endif %}
                  {% endfor %}
                {% else %}
                  {% comment %} Fallback for single variant products {% endcomment %}
                  <button 
                    class="color-swatch active"
                    data-variant-id="{{ product.selected_or_first_available_variant.id }}"
                    data-image-url="{{ product.featured_image | img_url: '400x400' }}"
                    data-product-id="{{ product.id }}"
                    style="background-color: #CDAA7D;"
                    title="Default"
                    aria-label="Select default color"
                  >
                    <span class="color-name">Default</span>
                  </button>
                {% endif %}
              </div>
            </div>

            <div class="footwear-info">
              <h3 class="footwear-title">
                <a href="{{ product.url }}">{{ product.title }}</a>
              </h3>
              
              <div class="footwear-price">
                {% if product.compare_at_price > product.price %}
                  <span class="price-sale">{{ product.price | money }}</span>
                  <span class="price-compare">{{ product.compare_at_price | money }}</span>
                {% else %}
                  <span class="price-regular">{{ product.price | money }}</span>
                {% endif %}
              </div>

              <form action="/cart/add" method="post" enctype="multipart/form-data" class="footwear-form">
                <input type="hidden" name="id" value="{{ product.selected_or_first_available_variant.id }}">
                <input type="hidden" name="quantity" value="1">
                <button 
                  type="submit" 
                  class="footwear-add-to-cart"
                  {% unless product.available %}disabled{% endunless %}
                >
                  {% if product.available %}
                    Add to Cart
                  {% else %}
                    Sold Out
                  {% endif %}
                </button>
              </form>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="footwear-empty-state">
        {% if section.settings.collection == blank %}
          <p>Please select a collection in the theme customizer.</p>
        {% elsif selected_collection == blank %}
          <p>Collection not found. Please check the collection selection.</p>
        {% else %}
          <p>No products found in the selected collection "{{ selected_collection.title }}".</p>
          <p>Collection has {{ selected_collection.products.size }} products.</p>
        {% endif %}
      </div>
    {% endif %}

    {% if section.settings.button_text != blank and section.settings.button_url != blank %}
      <div class="section-footer">
        <a href="{{ section.settings.button_url }}" class="section-button">
          {{ section.settings.button_text }}
        </a>
      </div>
    {% endif %}
  </div>
</div>

{% schema %}
{
  "name": "Featured Footwear",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Heading",
      "default": "Featured Footwear"
    },
    {
      "type": "textarea",
      "id": "subheading",
      "label": "Subheading",
      "default": "Discover our latest collection of premium footwear with multiple color options"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Select a collection to display products from"
    },
    {
      "type": "range",
      "id": "products_to_show",
      "min": 1,
      "max": 8,
      "step": 1,
      "label": "Number of products to show",
      "default": 2
    },
    {
      "type": "text",
      "id": "button_text",
      "label": "Button Text",
      "default": "View All Footwear"
    },
    {
      "type": "url",
      "id": "button_url",
      "label": "Button URL"
    },
    {
      "type": "header",
      "content": "Section Settings"
    },
    {
      "type": "select",
      "id": "color_scheme",
      "options": [
        {
          "value": "background-1",
          "label": "Background 1"
        },
        {
          "value": "background-2",
          "label": "Background 2"
        },
        {
          "value": "inverse",
          "label": "Inverse"
        },
        {
          "value": "accent-1",
          "label": "Accent 1"
        },
        {
          "value": "accent-2",
          "label": "Accent 2"
        }
      ],
      "default": "background-1",
      "label": "Color scheme"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Top padding",
      "default": 36
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "Bottom padding",
      "default": 36
    }
  ],
  "presets": [
    {
      "name": "Featured Footwear",
      "settings": {
        "heading": "Featured Footwear",
        "subheading": "Discover our latest collection of premium footwear with multiple color options",
        "products_to_show": 2,
        "button_text": "View All Footwear"
      }
    }
  ]
}
{% endschema %}